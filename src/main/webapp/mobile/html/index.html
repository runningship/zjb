<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
<title>中介宝</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link href="../css/reset.css" rel="stylesheet">
<link href="../css/style.css" rel="stylesheet">
<script src="../js/jquery.min.js" type="text/javascript"></script>
<script src="../js/layer/layer.js" type="text/javascript"></script>
<script src="../js/javascript.js" type="text/javascript"></script>
<script type="text/javascript">
var isLayoutOpen = false;
var isChuzu=false;
var header;
var mainer;
var houseType="";
apiready = function(){
	header = $('#header');
	mainer = $('#mainer');
	isLayoutOpen = api.pageParam.isLayoutOpen;
	exitApp();
	//openHouses();
	openGroup();
	//bindTecentPush();
};

function openGroup(){
	houseType = "house";
	api.openFrameGroup ({
	    name: 'group1',
	    background:'#fff',
	    scrollEnabled:false,
	    preload:2,
	    rect:{x: 0,
            y: header.height(),
            w: 'auto',
            h: mainer.height()},
	    index:0,
	    frames:
	    [{
	        name: 'house', 
	        url: 'house.html',
	        bgColor: '#fff'
	    },{
	        name: 'fujin', 
	        url: 'fujin.html', 
	        bgColor: '#fff'
	    },{
	        name: 'work', 
	        url: 'work.html', 
	        bounces: true,
	        bgColor: '#fff'
	    }]
	}, function(ret, err){
	    var name = ret.name;
	    var index = ret.index;
	});
}

function exitApp(){
    api.addEventListener({
        name: 'keyback'
    }, function(ret, err){
        api.toast({
                msg: '再按一次退出',
                duration:2000,
                location: 'middle'
            });

            api.addEventListener({
                name: 'keyback'
            }, function(ret, err){
                api.closeWidget({
                        id: 'A6989896004356',     //这里改成自己的应用ID
                        retData: {name:'closeWidget'},
                        silent:true
                    });
            });

            setTimeout(function(){
                    exitApp();
            },3000)
    });
}

function setHouseType(chuzu){
	isChuzu = chuzu;
	$('.btnGroup a').removeClass('active');
	if(isChuzu){
		$('.chuzu').addClass('active');
	}else{
		$('.chushou').addClass('active');
	}
}
function switchHouseType(chuzu){
	setHouseType(chuzu);
	if(houseType=="house"){
		api.execScript({
		    frameName: 'house',
		    script: 'switchType('+isChuzu+')'
		});
	}else{
		api.execScript({
		    frameName: 'fujin',
		    script: 'switchType('+isChuzu+')'
		});
	}
}
function openHouses(chuzu){
	if($('.house.active').length>0){
		return;
	}
	houseType = "house";
	//open houses
	$('#footer .item').removeClass('active');
	$('#footer .house').addClass('active');
	api.openFrame({
        name: 'house',
		url: 'house.html',
		vScrollBarEnabled:true,
		pageParam:{isChuzu:isChuzu},
		reload:false,
        bounces: true,
        animation:{
		    type:"push",
		    subType:"from_left",
		    duration:300
		},
        rect: {
            x: 0,
            y: header.height(),
            w: 'auto',
            h: mainer.height()
        }
    });
	setHouseType(chuzu);
}

function openFujin(chuzu){
	if($('.fujin.active').length>0){
		return;
	}
	houseType = "fujin";
	$('#footer .item').removeClass('active');
	$('#footer .fujin').addClass('active');
	api.openFrame({
        name: 'fujin',
		url: 'fujin.html',
		pageParam:{isChuzu:isChuzu},
		reload:false,
		animation:{
		    type:"push",
		    subType:"from_right",
		    duration:300
		},
        bounces: true,
        vScrollBarEnabled:true,
        rect: {
            x: 0,
            y: header.height(),
            w: 'auto',
            h: mainer.height()
        }
    });
	setHouseType(chuzu);
}

function openWork(){
	if($('.work.active').length>0){
		return;
	}
	$('#footer .item').removeClass('active');
	$('#footer .work').addClass('active');
	api.openFrame({
        name: 'work',
		url: 'work.html',
		pageParam:{isChuzu:isChuzu},
		reload:false,
		animation:{
		    type:"push",
		    subType:"from_right",
		    duration:300
		},
        bounces: false,
        vScrollBarEnabled:true,
        rect: {
            x: 0,
            y: header.height(),
            w: 'auto',
            h: mainer.height()
        }
    });
}
function openSearch(){
	//alert();
	api.openWin({
	    name: 'search',
	    bounces: false,
	    softInputMode:'resize',
		url: 'search.html'
	});
}


function bindTecentPush(){
	// 注册设备并绑定用户账号
	var tencentPush = api.require('tencentPush');

	var resultCallback = function(ret, err){
		alert(JSON.stringify(err));
	    if(ret.status){
	        alert("注册成功，token为："+ret.token);
	    }else{
	        alert("注册失败，错误码："+err.code+"，错误信息："+err.msg);
	    }
	};

	// 需要绑定的账号，若为"*"表示解除之前的账号绑定
	var params = {account:"15856985122"};
	tencentPush.registerPush( resultCallback);
}
</script>
<style type="text/css">
#mainer{
    -webkit-box-flex: 1; 
    -webkit-flex: 1;
    flex: 1;
}
</style>
</head>
<body>
<div id="wrap" class="bodyer house">
    <div id="header" class="header">
        <span class="left">
            <span onclick="openUserPanel();" class="imgbox"><img src="../images/71.jpg" alt="" class="img"></span>
        </span>
        <span class="conter">
            <span class="btnGroup">
                <a href="javascript:void(0)" class="btns active chushou" onclick="switchHouseType(false);">出售</a><a href="javascript:void(0)" class="btns chuzu" onclick="switchHouseType(true);">出租</a>
            </span>
        </span>
        <span class="right">
            <a href="#" class="btns" id="search" onclick="openSearch();"><i class="iconfont">&#xe602;</i></a>
        </span>
    </div>
    <div id="mainer" class="mainer">
        
    </div>
    <div id="footer" class="footer">
        <a class="item house active">
            <div>
                <i class="iconfont n">&#xe605;</i>
                <i class="iconfont y">&#xe606;</i>
            </div>
            <h2 onclick="openHouses(isChuzu)">房源</h2>
        </a>
        <a class="item  fujin">
            <div>
                <i class="iconfont n">&#xe623;</i>
                <i class="iconfont y">&#xe652;</i>
            </div>
            <h2 onclick="openFujin(isChuzu)">附近</h2>
        </a>
        <a class="item work">
            <div>
                <i class="iconfont n">&#xe653;</i>
                <i class="iconfont y">&#xe654;</i>
            </div>
            <h2 onclick="openWork();">工作</h2>
        </a>
    </div>
</div>
</body>
</html>