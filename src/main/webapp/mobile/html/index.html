<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
<title>中介宝</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link href="../css/reset.css" rel="stylesheet">
<link href="../css/style.css" rel="stylesheet">
<script src="../js/jquery.min.js" type="text/javascript"></script>
<script src="../js/layer/layer.js" type="text/javascript"></script>
<script src="../js/common.js" type="text/javascript"></script>
<script src="../js/javascript.js" type="text/javascript"></script>
<script type="text/javascript">
var isLayoutOpen = false;
var isHouseChuzu=false;
var isFujinChuzu = false;
var header;
var mainer;
var actionType="";
var statusBarHeight=0;
var lastAction="house";
apiready = function(){
	header = $('#header');
	mainer = $('#mainer');
	getConfig(function(cfg){
		config = cfg;
		if(config && config.user && config.user.avatar){
				$('#avatar').attr('src',api.wgtRootDir+'/v4/avatar/'+config.user.avatar+'.jpg');
		}else{
			$('#avatar').attr('src','http://192.168.1.222:8081/mobile/images/zjb.png');
		}
		isLayoutOpen = api.pageParam.isLayoutOpen;
		//bindTecentPush();
		exitApp();
		openGroup();
	});
};

function openGroup(){
	actionType = "house";
	api.openFrameGroup ({
	    name: 'group1',
	    background:'#fff',
	    scrollEnabled:false,
	    preload:2,
	    rect:{x: 0,
            y: header.height()+statusBarHeight,
            w: 'auto',
            h: mainer.height()},
	    index:0,
	    frames:
	    [{
	        name: 'house', 
	        url: 'house.html',
	        bgColor: '#fff'
	    },{
	        name: 'fujin', 
	        url: 'fujin.html', 
	        bgColor: '#fff'
	    },{
	        name: 'work', 
	        url: 'work.html', 
	        bounces: true,
	        bgColor: '#fff'
	    }]
	}, function(ret, err){
	    var name = ret.name;
	    var index = ret.index;
	});
}

function exitApp(){
    api.addEventListener({
        name: 'keyback'
    }, function(ret, err){
//         api.toast({
//                 msg: '再按一次退出',
//                 duration:2000,
//                 location: 'middle'
//             });
		//blockAlert('再按一次退出');
		api.confirm({
			msg: '确定要退出程序吗?',
		    buttons:['确定', '取消']
		},function(ret,err){
		    if(ret.buttonIndex == 1){
		        //api.alert({msg:ret.text});
		    	 api.closeWidget({
                     id: 'A6989896004356',     //这里改成自己的应用ID
                     retData: {name:'closeWidget'},
                     silent:true
                 });
		    }
		});
//         api.addEventListener({
//             name: 'keyback'
//         }, function(ret, err){
//             api.closeWidget({
//                     id: 'A6989896004356',     //这里改成自己的应用ID
//                     retData: {name:'closeWidget'},
//                     silent:true
//                 });
//         });

//         setTimeout(function(){
//                 exitApp();
//         },3000)
    });
}

//更新出租出售按钮效果 
function updateActionType(){
	$('.btnGroup a').removeClass('active');
	if(actionType=="house"){
		if(isHouseChuzu){
			$('.chuzu').addClass('active');
		}else{
			$('.chushou').addClass('active');
		}
	}else{
		if(isFujinChuzu){
			$('.chuzu').addClass('active');
		}else{
			$('.chushou').addClass('active');
		}
	}
	
}
function switchHouseType(chuzu){
	if(actionType=="house"){
		isHouseChuzu = chuzu;
		api.execScript({
		    frameName: 'house',
		    script: 'switchType('+isHouseChuzu+')'
		});
	}else{
		isFujinChuzu = chuzu;
		api.execScript({
		    frameName: 'fujin',
		    script: 'switchType('+isFujinChuzu+')'
		});
	}
	updateActionType();
}
function openHouses(){
	lastAction="house";
	$('.conter .h').show();
	$('.conter .w').hide();
	if($('.house.active').length>0){
		return;
	}
	actionType = "house";
	//open houses
	$('#footer .item').removeClass('active');
	$('#footer .house').addClass('active');
	api.openFrame({
        name: 'house',
		url: 'house.html',
		vScrollBarEnabled:true,
		pageParam:{isChuzu:isHouseChuzu},
		reload:false,
        bounces: true,
        animation:{
		    type:"push",
		    subType:"from_left",
		    duration:300
		},
        rect: {
            x: 0,
            y: header.height()+statusBarHeight,
            w: 'auto',
            h: mainer.height()
        }
    });
	updateActionType();
}

function openFujin(){
	$('.conter .h').show();
	$('.conter .w').hide();
	if($('.fujin.active').length>0){
		return;
	}
	actionType = "fujin";
	$('#footer .item').removeClass('active');
	$('#footer .fujin').addClass('active');
	var subType = "from_right";
	if(lastAction=="work"){
		subType="from_left";
	}
	api.openFrame({
        name: 'fujin',
		url: 'fujin.html',
		pageParam:{isChuzu:isFujinChuzu},
		reload:false,
		animation:{
		    type:"push",
		    subType:subType,
		    duration:300
		},
        bounces: true,
        vScrollBarEnabled:true,
        rect: {
            x: 0,
            y: header.height()+statusBarHeight,
            w: 'auto',
            h: mainer.height()
        }
    });
	updateActionType();
}

function openWork(){
	lastAction="work";
	$('.conter .h').hide();
	$('.conter .w').show();
	if($('.work.active').length>0){
		return;
	}
	$('#footer .item').removeClass('active');
	$('#footer .work').addClass('active');
	api.openFrame({
        name: 'work',
		url: 'work.html',
		reload:false,
		animation:{
		    type:"push",
		    subType:"from_right",
		    duration:300
		},
        bounces: false,
        vScrollBarEnabled:true,
        rect: {
            x: 0,
            y: header.height()+statusBarHeight,
            w: 'auto',
            h: mainer.height()
        }
    });
}
function openSearch(){
	//alert();
	api.openWin({
	    name: 'search',
	    bounces: false,
	    softInputMode:'resize',
		url: 'search.html'
	});
}


function bindTecentPush(){
	// 注册设备并绑定用户账号
	blockAlert(3432);
	var tencentPush = api.require('tencentPush');

	var resultCallback = function(ret, err){
		blockAlert(JSON.stringify(ret));
	    if(ret.status){
	    	blockAlert("注册成功，token为："+ret.token);
	    }else{
	    	blockAlert("注册失败，错误码："+err.code+"，错误信息："+err.msg);
	    }
	};

	// 需要绑定的账号，若为"*"表示解除之前的账号绑定
	var params = {account:"15856985122"};
	tencentPush.registerPush( params,resultCallback);
	
	var params2 = {name:"notifactionClick"};    
	tencentPush.setListener(params2, function(ret, err){
		blockAlert("收到通知被点击的回调，title："+ret.title+"，content："+ret.content+"，customContent："+ret.customContent 
			    + ",activity:"+ret.activity+",actionType:"+ret.actionType+",msgid:"+ret.msgid);
	});
}
</script>
<style type="text/css">
#mainer{
    -webkit-box-flex: 1; 
    -webkit-flex: 1;
    flex: 1;
}
</style>
</head>
<body>
<div id="wrap" class="bodyer house">
    <div id="header" class="header">
        <span class="left">
            <span onclick="openUserPanel();" class="imgbox"><img id="avatar" src="" alt="" class="img"></span>
        </span>
        <span class="conter">
            <span class="btnGroup h">
                <a href="javascript:void(0)" class="btns active chushou" onclick="switchHouseType(false);">出售</a><a href="javascript:void(0)" class="btns chuzu" onclick="switchHouseType(true);">出租</a>
            </span>
            <span class="btnGroup w" style="display:none">
                <span>工作</span>
            </span>
        </span>
        <span class="right">
            <a href="#" class="btns" id="search" onclick="openSearch();"><i class="iconfont">&#xe602;</i></a>
        </span>
    </div>
    <div id="mainer" class="mainer">
        
    </div>
    <div id="footer" class="footer">
        <a class="item house active">
            <div>
                <i class="iconfont n">&#xe605;</i>
                <i class="iconfont y">&#xe606;</i>
            </div>
            <h2 onclick="openHouses()">房源</h2>
        </a>
        <a class="item  fujin">
            <div>
                <i class="iconfont n">&#xe623;</i>
                <i class="iconfont y">&#xe652;</i>
            </div>
            <h2 onclick="openFujin()">附近</h2>
        </a>
        <a class="item work">
            <div>
                <i class="iconfont n">&#xe653;</i>
                <i class="iconfont y">&#xe654;</i>
            </div>
            <h2 onclick="openWork();">工作</h2>
        </a>
    </div>
</div>
</body>
</html>