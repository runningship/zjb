<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta HTTP-EQUIV="pragma" CONTENT="no-cache">
<meta HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
<meta HTTP-EQUIV="expires" CONTENT="0">
<title>众邦房源管理系统</title>
<link rel="stylesheet" href="/zb/jsLib/themes/base/jquery.ui.all.css" />
<link rel="stylesheet" href="/zb/jsLib/jquery-smartMenu/css/smartMenu.css" />
<link rel="stylesheet" href="/zb/style/window.css" />
<script type="text/javascript" src="/zb/jsLib/jquery-1.6.2.js"></script>
<script type="text/javascript" src="/zb/jsLib/myLib.js"></script>
<script type="text/javascript" src="/zb/jsLib/jquery-ui-1.8.16.custom.min.js"></script>
<script type="text/javascript" src="/zb/jsLib/jquery.winResize.js"></script>
<script type="text/javascript" src="/zb/jsLib/jquery-smartMenu/js/mini/jquery-smartMenu-min.js"></script>
<script type="text/javascript" src="/zb/jsLib/window.js"></script>
<script type="text/javascript" src="/zb/js/jquery.caozuobendi.js"></script>
<script type="text/javascript" src="/zb/js/Dialog/jquery.artDialog.js?skin=aero"></script>
<script type="text/javascript" src="/zb/js/Dialog/plugins/iframeTools.js"></script>
<link rel="stylesheet" type="text/css" href="/zb/chat.css" />
<script type="text/javascript" src="/zb/js/jquery.hotkeys.js"></script>
<script type="text/javascript" src="/zb/js/buildHtml.js"></script>
<script type="text/javascript" src="/zb/js/im.js"></script>
<script type="text/javascript">
try{
//  hex.sizeTo(1024,700);
  maximize();
  //hex.moveTo(x, y)
  //hex.updateManifest()
}catch(e){

}

   //初始化桌面右键菜单
var data=[
    [{text:"刷新",func:function(){
        window.location.reload()
      }
    }],[{text:"退出系统",func:function(){
        WinClose();
      } 
    }]
  ];
var socket;
var hostname;
var chatWindow=null;
$(function(){
	//存储桌面布局元素的jquery对象
	myLib.desktop.desktopPanel();
	//初始化任务栏
	myLib.desktop.taskBar.init();
	//初始化桌面图标
	myLib.desktop.deskIcon.init();
	//初始化侧边栏
	myLib.desktop.lrBar.init();
	//初始化桌面右键菜单
	myLib.desktop.contextMenu($(document.body),data,"body",10);
  init();
});
var myId;
function init(){
  YW.ajax({
    type: 'POST',
    url: '/zb/c/user/initIndex',
    data:'',
    success: function(data){
      var json = JSON.parse(data);
      $('#userinfo').text(json.username+' ('+json.role+')');
      myId = json.userId;
      hostname = json.hostname;
      $('#win_im').click();
      // chatWindow.close();
    }
  });
}
function openFanKui(){
  art.dialog.open('sys/fankui_add.html',{
      padding:0,
      resize:true,
      lock:1,
      height:300,
      width:505,
      title:'意见反馈',
      resize:false
  });
}
function openPassword(){
  art.dialog.open('sys/password_edit.html',{
      padding:0,
      resize:true,
      lock:1,
      height:250,
      width:400,
      title:'修改密码',
      resize:false
  });
}

function openChat(e,hidden){
  if(e!=null){
    e.cancelBubble=true;
    e.preventDefault();
  }
  if(chatWindow==null){
    chatWindow = art.dialog.open('im.html?hostname='+hostname+'&userId='+myId,{
    // chatWindow = art.dialog.open('/zb/v/oa/index.html',{
      padding:0,
      height:605,
      width:930,
      title:'',
      resize:false,
      skin:'idialog',
      close:function(){
        // $(art.dialog.opener.document).find('.idialog').remove();
        this.hide();
        return false;
      }
    });
  }else{
    chatWindow.show();
    var xx = $('.idialog')
    xx.find('iframe').css('display','block');
  }
}

function readMsg(readCount){
  var msgCount=$('#msgCount');
  var count = parseInt(msgCount.text());
  var read = parseInt(readCount);
  count = count - readCount;
  msgCount.text(count);
  if(count<=0){
    msgCount.css('display','none');
  }
}

function receiveChatMessage(data){
	//alert(data);
	var msgCount=$('#msgCount');
	var count = parseInt(msgCount.text());
	count++;
	msgCount.text(count);
	msgCount.css('display','');	
}
function logout(){
  YW.ajax({
    type: 'POST',
    url: '/zb/c/user/logout',
    data:'',
    success: function(data){
      alert('正在关闭...');
      hex.close();
    },
    error:function(data){
      hex.close();
    }
  });
}

function relogin(){
  YW.ajax({
    type: 'POST',
    url: '/zb/c/user/logout',
    data:'',
    success: function(data){
      	revert();
    	document.location="/zb/login/login.html?"+Math.random();
      
    },
    error:function(data){
      hex.close();
    }
  });
}

function maximize(){
  hex.maximize();
  $('.tbtnMax').css('display','none');
  $('.tbtnRevert').css('display','inline-block');
}

function revert(){
  hex.restore();
  $('.tbtnMax').css('display','inline-block');
  $('.tbtnRevert').css('display','none');
}

function showMenu(e){
  $('#start_item').css('display','block');
  e.cancelBubble=true;
}
</script>
<style type="text/css">
html{border:1px solid #000;}
.loading{background:'';}
.tool{ background-color: ;position: absolute;right:1px; top: 1px;}
.btnbox{width: 200px; text-align: right;}
.tbtn{ display: inline-block; height: 20px; width: 30px;margin-right: -10px;-webkit-transition:all .3s;}
.tbtn i{ display: inline-block; height: 100%; width: 100%; background: url(/zb/style/image/winBtn.png) no-repeat left top;}
.tbtn.tbtnMenu i{background-position: -10px 0 }
.tbtn.tbtnMin i{background-position:-60px 0 }
.tbtn.tbtnMax i{background-position:-110px 0 }
.tbtn.tbtnRevert {display: none}
.tbtn.tbtnRevert i{background-position:-110px 0 ;}
.tbtn.tbtnClose{ width:50px;}
.tbtn.tbtnClose i{background-position:-155px 0 }
.tbtn.tbtnMenu:hover,.tbtn.tbtnMin:hover,.tbtn.tbtnMax:hover,.tbtn.tbtnRevert:hover{background-image:linear-gradient(to bottom,rgba(0,153,255,0.9) 0%,rgba(0,153,255,0) 100%);}
.tbtn.tbtnClose:hover{background-image:linear-gradient(to bottom,rgba(255,0,0,0.9) 0%,rgba(255,0,0,0) 100%);}

.desktop_icon_over {
/* background: url(image/icon_over.png) no-repeat center center; */
background-image: none;
background-color: rgba(0,0,0,0.3);
border-radius: 6px;
box-shadow: 0px 1px 5px #000;
/*border: 1px solid #333;*/
}
</style>
</head>
<body>
<div class="tool">
    <div class="btnbox">
        <a href="javascript:void(0)" class="tbtn tbtnMenu" data-q="menu" onclick="showMenu(event);"><i></i>
        </a>
        <a href="" onclick="hex.minimize();" class="tbtn tbtnMin" data-q="min"><i></i></a>
        <a href="" onclick="maximize();" class="tbtn tbtnMax" data-q="max"><i></i></a>
        <a href="" onclick="revert();" class="tbtn tbtnRevert" data-q="revert"><i></i></a>
        <a href="" onclick="logout()" class="tbtn tbtnClose" data-q="close"><i></i></a>
    </div>
    <div id="rr_bar" >
      <!-- <div id="start_block" style="margin-left:110px;"> 
        <a title="开始" id="start_btn"></a>
        
      </div> -->
      <div id="start_item">
          <ul class="item admin">
            <li ><span class="adminImg" ></span><div id="userinfo"></div></li>
          </ul>
          <ul class="item">
            <li onclick="openPassword()"><span class="sitting_btn"></span>修改密码</li>
            <li onclick="openFanKui()"><span class="about_btn"></span>意见反馈</li>
            <li onclick="relogin()"><span class="logout_btn"></span>重新登录</li>
          </ul>
        </div>
    </div>
</div>
<!-- <div id="tool">
  <div style="float:right">
    <a class="min" onclick="hex.minimize();" href="javascript:;" title="最小化"></a>
    <a class="max" onclick="maximize();" href="javascript:;" title="最大化"></a>
    <a class="revert" onclick="revert();" href="javascript:;" title="还原"></a>
    <a class="close" onclick="logout()" href="javascript:;" title="关闭"></a>
  </div>
</div> -->
<div style="">

<ul id="deskIcon">
  <li auth="fy" class="desktop_icon" id="win5" path="/zb/v/house/index.html"> <span class="icon"><img src="/zb/style/icon/ico_b_house_big.png"/></span>
    <div class="text">房源管理
      <div class="right_cron"></div>
    </div>
  </li>
  <li auth="ky" class="desktop_icon" id="win6" path="/zb/v/client/index.html"> <span class="icon"><img src="/zb/style/icon/ico_b_client_big.png"/></span>
    <div class="text">客源管理
      <div class="right_cron"></div>
    </div>
  </li>
  <li auth="yw" class="desktop_icon" id="win7" path="/zb/v/yewu/index.html"> <span class="icon"><img src="/zb/style/icon/ico_b_yewu_big.png"/></span>
    <div class="text">业务管理
      <div class="right_cron"></div>
    </div>
  </li>
  <li auth="ht" class="desktop_icon" id="win8" path="/zb/v/hetong/index.html"> <span class="icon"><img src="/zb/style/icon/ico_b_hetong_big.png"/></span>
    <div class="text">合同管理
      <div class="right_cron"></div>
    </div>
  </li>
  <li auth="rs" class="desktop_icon" id="win9" path="/zb/v/renshi/index.html"> <span class="icon"><img src="/zb/style/icon/ico_b_renshi_big.png"/></span>
    <div class="text">人事管理
      <div class="right_cron"></div>
    </div>
  </li>
  <li auth="xz" class="desktop_icon" id="win10" path="/zb/v/xingzheng/index.html"> <span class="icon"><img src="/zb/style/icon/ico_b_xingzheng_big.png"/></span>
    <div class="text">行政管理
      <div class="right_cron"></div>
    </div>
  </li>
  <li auth="zc" class="desktop_icon" id="win11" path="/zb/v/assets/index.html"> <span class="icon"><img src="/zb/style/icon/ico_b_zichan_big.png"/></span>
    <div class="text">资产管理
      <div class="right_cron"></div>
    </div>
  </li>
  <li auth="oa" class="desktop_icon" id="win12" path="/zb/v/oa/index.html"> <span class="icon"><img src="/zb/style/icon/ico_b_oa_big.png"/></span>
    <div class="text">OA管理
      <div class="right_cron"></div>
    </div>
  </li>
  <li auth="xt" class="desktop_icon" id="win13" path="/zb/v/sys/index.html"> <span class="icon"><img src="/zb/style/icon/ico_b_shezhi_big.png"/></span>
    <div class="text">后台管理
      <div class="right_cron"></div>
    </div>
  </li>
  <li class="desktop_icon" id="win_im" ignoreDblClick="true" onclick="openChat(event);"> 
  	<span  class="icon">
  	<img src="/zb/style/icon/ico_b_im.png" />	
  	</span>
  	<span id="msgCount" style="display:none;position:absolute;background:red;color:white;top:10px;right:10px;border-radius:8px;height:15px;width:18px;text-align:center;">0</span>
    <div class="text">im
      <div class="right_cron"></div>
    </div>
  </li>
</ul>

<div id="taskBar">
  <div id="leftBtn"><a href="#" class="upBtn"></a></div>
  <div id="rightBtn"><a href="#" class="downBtn"></a> </div>
  <div id="task_lb_wrap">
    <div id="task_lb"></div>
  </div>
</div>
</div>

</body>

</html>
